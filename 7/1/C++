//пользователь вводит слово
//программа составляет всевозможные (существующие) слова из букв заданного слова

#include "std_lib_facilities.h"
#include "windows.h"

int main()
{
	setlocale(LC_ALL, "Rus");
	SetConsoleCP(1251);
	SetConsoleOutputCP(1251);

	string s;
	cout << "Введите слово ";
	cin >> s;
	int n = 0, x = 1, i = 0;
	while (s[n] != '\0')
	{
		n++;
		x = x * n;
	}

//преобразование строки в массив типа char
	char *str = new char[n];
	char *str_add = new char[n];
	for (i = 0; i < n; i++)
	{
		str[i] = s[i];
		str_add[i] = 97 + i;
	}

//устранение заглавных букв и смена 'ё' на 'е'
	for (i = 0; i < n; i++)
	{
		int symbol = str[i];
		
		if ((symbol >= -64) and (symbol <= -33))
		{
			str[i] = symbol + 32;
		}
		else
		{
			if (symbol == -72 || symbol == -88)
			{
				str[i] = -27;
			}
		}
	}

	int *var = new int[2 * n + 2];
	var[n] = x;
	var[0] = 0;
	for (i = 1; i < n; i++)
	{
		x /= i;
		var[n - i] = x;
	}

	var[n + 1] = 0;
	var[n + 2] = var[1];
	for (i = 2; i <= n; i++)
	{
		var[i+n+1] = var[i];
		var[i+n+1] += var[i+n];
	}

	x = 0;
	for (i = 1; i <= n; i++)
	{
		x += var[i];
	}

	cout << "\nКоличество комбинаций без учета повт. символов = " << x << "\n";

//составление комбинаций без учета возможных повт. символов в изначальной строке
	string *mas_add = new string[x];
	string *mas = new string[x];
	int j, k, t, g, h = 0;
	for (i = 0; i < n; i++)
	{
		for (k = 0; k < (i + 1); k++)
		{
			for (j = var[i + n + 1]; j < var[i + n + 2]; j++)
			{
				if (k > 0 and (mas_add[j - 1][k - 1] != mas_add[j][k - 1]))
				{
					h = 0;
				}
				t = ((j - var[i + n + 1]) / (var[i + 1] / var[k + 1]) + h) % n;
				g = k;
				while (g > 0)
				{
					if (str_add[t] == mas_add[j][g - 1])
					{
						t = (t + 1) % n;
						g = k;
						h++;
					}
					else
					{
						g--;
					}
				}
				mas[j] = mas[j] + str[t];
				mas_add[j] = mas_add[j] + str_add[t];
			}
		}
	}

//проверка уникальности комбинаций
	bool uniq = true;
	for (i = 0; i < (n - 1); i++)
	{
		for (j = (i + 1); j < n; j++)
		{
			if (str[i] == str[j])
			{
				uniq = false;
			}
		}
	}

//устранение повторений (при их наличии)
	if (uniq == false)
	{
		cout << "\nВыполняется сортировка...\n";
		for (i = 0; i < (x - 1); i++)
		{
			if (mas[i] != "0")
			{
				for (j = (i + 1); j < x; j++)
				{
					if (mas[i] == mas[j])
					{
						mas[j] = "0";
					}
				}
			}
		}
		
		j = 0;
		for (i = 0; i < x; i++)
		{
			if (mas[i] != "0")
			{
				mas_add[j] = mas[i];
				j++;
			}
		}
		cout << "сортировка завершена.\n";
	}
	else
	{
		j = 0;
		for (i = 0; i < x; i++)
		{
			mas_add[j] = mas[i];
			j++;
		}
	}

//перенос слов в массив с соответстующим количеством элементов
	string *mas_output = new string[j];
	for (i = 0; i < j; i++)
	{
		mas_output[i] = mas_add[i];
	}
	cout << "\nКоличество уникальных комбинаций = " << j << "\n";
	
//подсчет слов в базе данных и перенос в массив
	ifstream input("database.txt");
	while (getline(input, s))
	{
		t++;
	}

	input.clear();
	input.seekg(0);

	i = 0;
	string *database = new string[t];
	while (getline(input, s))
	{
		database[i] = s;
		i++;
	}
	input.close();

	ofstream output("output.txt");

//поиск соответствий
	cout << "\nпоиск соответствий...";
	uniq = false;
	for (i = 0; i < j; i++)
	{
		for (k = 0; k < t; k++)
		{
			if (mas_output[i] == database[k])
			{
				output << mas_output[i] <<"\n";
				uniq = true;
			}
		}
	}
	output.close();

//вывод
	if (uniq == true)
	{
		ifstream result("output.txt");
		cout << "\nнайденные соответствия:\n";
		while (getline(result, s))
		{
			cout <<"  " << s << "\n";
		}
	}
	else
	{
		cout << "\nсоответствий не найдено.\n";
	}
	system("pause");
}
